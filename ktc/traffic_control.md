### 트래픽 제어 프로세스 개발 요건

- Spring Boot 기반 Redis Lua Script 실행하여 트래픽 진입/대기 제어 프로세스 구축 예정
  - 트래픽 대기 최대 건수 : 100K
- 1분당 트래픽 진입 확인 요청을 하여 threshold 값만큼 진입 허용
  - 1분당 트래픽 진입 허용 트래픽은 순서대로 6초당 threshold/10 개씩 진입 허용 처리
- 이미 트래픽 진입한 요청이 threshold 값을 초과하는 경우 뒤에 들어온 트래픽 진입 요청은 대기 처리
- 트래픽 진입 대기 처리하여 아래와 같은 대기 상태 반환 처리
  - 현재 대기 순번
  - 대기 예상 시간(초 단위)
  - 전체 대기 수
- 모든 트래픽은 클라이언트에서 생성한 `token(토큰)` 식별자로 진입 대기 처리
- 클라이언트에서 동일 토큰 기준 3초 단위로 트래픽 진입 확인 요청하여 트래픽 진입 대기 상태 확인
  - 3초 폴링하여 트래픽 진입 허용되는 경우, 폴링 중단
  - 단, 1분15초 넘도록 폴링 요청오지 않는 토큰은 만료 처리
- 클라이언트 3초 폴링으로 트래픽 진입 확인 요청에 대해서는 트래픽 대기 순서대로 진입 처리
- threshold 값은 외부 API 통해서 Redis Cache 를 직접 변경 가능하기 때문에, 해당 Lua Script 가 실행될 때는 변경된 threshold 값을 바로 참조하여 트래픽 진입 허용 or 대기 처리하도록 구성 필요

#### 예상 시나리오

##### threshold 1분당 100개 진입 허용 상황에서 총 200개 트래픽 진입 요청한 경우

- 0 ~ 6초까지 1 ~ 10개 진입
- 6 ~ 12초까지 11 ~ 20개 진입
- 12 ~ 18초까지 21 ~ 30개 진입
- 18 ~ 24초까지 31 ~ 40개 진입
- 24 ~ 30초까지 41 ~ 50개 진입
- 30 ~ 36초까지 51 ~ 60개 진입
- 36 ~ 42초까지 61 ~ 70개 진입
- 42 ~ 48초까지 71 ~ 80개 진입
- 48 ~ 54초까지 81 ~ 90개 진입
- 54 ~ 60초까지 91 ~ 100개 진입
- 60 ~ 66초까지 101 ~ 110개 진입
- 66 ~ 72초까지 111 ~ 120개 진입
- 72 ~ 78초까지 121 ~ 130개 진입
- 78 ~ 84초까지 131 ~ 140개 진입
- 84 ~ 90초까지 141 ~ 150개 진입
- 90 ~ 96초까지 151 ~ 160개 진입
- 96 ~ 102초까지 161 ~ 170개 진입
- ...
