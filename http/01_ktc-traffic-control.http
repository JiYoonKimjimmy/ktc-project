### 환경 변수 설정
@baseUrl = http://localhost:21000/ktc/api/v1
@zoneId = KTC_TEST_ZONE
@clientIp = 127.0.0.1
@clientAgent = WEB

### 테스트 토큰 설정
@token1 = TEST_TOKEN_1
@token2 = TEST_TOKEN_2
@token3 = TEST_TOKEN_3
@token4 = TEST_TOKEN_4
@token5 = TEST_TOKEN_5
@token6 = TEST_TOKEN_6
@token7 = TEST_TOKEN_7
@token8 = TEST_TOKEN_8
@token9 = TEST_TOKEN_9
@token10 = TEST_TOKEN_10

### 토큰 1 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token1}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse1", response.body); %}

### 2. 트래픽 진입 폴링 (poolingPeriod 기준)
# @name entryPolling1
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token1}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 1 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse1").waiting.poolingPeriod;
        client.test("토큰 1 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll1", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 2 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token2}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse2", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling2
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token2}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 2 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse2").waiting.poolingPeriod;
        client.test("토큰 2 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll2", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 3-10 테스트 (동일한 패턴으로 반복)
### 토큰 3 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token3}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse3", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling3
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token3}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 3 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse3").waiting.poolingPeriod;
        client.test("토큰 3 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll3", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 4-10 테스트 (동일한 패턴으로 반복)
### 토큰 4 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token4}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse4", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling4
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token4}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 4 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse4").waiting.poolingPeriod;
        client.test("토큰 4 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll4", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 5-10 테스트 (동일한 패턴으로 반복)
### 토큰 5 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token5}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse5", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling5
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token5}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 5 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse5").waiting.poolingPeriod;
        client.test("토큰 5 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll5", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 6-10 테스트 (동일한 패턴으로 반복)
### 토큰 6 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token6}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse6", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling6
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token6}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 6 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse6").waiting.poolingPeriod;
        client.test("토큰 6 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll6", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 7-10 테스트 (동일한 패턴으로 반복)
### 토큰 7 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token7}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse7", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling7
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token7}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 7 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse7").waiting.poolingPeriod;
        client.test("토큰 7 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll7", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 8-10 테스트 (동일한 패턴으로 반복)
### 토큰 8 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token8}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse8", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling8
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token8}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 8 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse8").waiting.poolingPeriod;
        client.test("토큰 8 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll8", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 9-10 테스트 (동일한 패턴으로 반복)
### 토큰 9 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token9}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse9", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling9
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token9}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 9 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse9").waiting.poolingPeriod;
        client.test("토큰 9 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll9", true);
        }, poolingPeriod * 1000);
    }
%}

### 토큰 10 테스트
### 1. 트래픽 대기 요청
POST {{baseUrl}}/traffic/wait
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token10}}",
  "clientIp": "{{clientIp}}",
  "clientAgent": "{{clientAgent}}"
}

> {% client.global.set("waitingResponse10", response.body); %}

### 2. 트래픽 진입 폴링
# @name entryPolling10
POST {{baseUrl}}/traffic/entry
Content-Type: application/json

{
  "zoneId": "{{zoneId}}",
  "token": "{{token10}}"
}

> {%
    if (response.body.canEnter) {
        client.test("토큰 10 진입 성공", function() {
            client.assert(response.body.canEnter === true, "canEnter가 true가 아님");
        });
    } else {
        const poolingPeriod = client.global.get("waitingResponse10").waiting.poolingPeriod;
        client.test("토큰 10 대기 중", function() {
            client.assert(response.body.canEnter === false, "canEnter가 false가 아님");
        });
        setTimeout(function() {
            client.global.set("shouldPoll10", true);
        }, poolingPeriod * 1000);
    }
%}
